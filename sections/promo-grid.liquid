{% comment %}
  MYMY – Grid exacta:
  - Izquierda: card vertical (logo + 2 imágenes de producto)
  - Derecha arriba: banner promo
  - Derecha abajo: 2 mini-cards (lado a lado)
{% endcomment %}

{% comment %} Ajustes seguros con defaults {% endcomment %}
{% assign gap = section.settings.gap | default: 12 %}
{% assign radius = section.settings.radius | default: 16 %}
{% assign accent = section.settings.accent | default: '#f8ccd2' %}
{% assign logo_max_width = section.settings.logo_max_width | default: 200 %}
{% assign prod_img_max_width = section.settings.prod_img_max_width | default: 300 %}

<section
        id="mymy-grid-{{ section.id }}"
        class="mymy-grid"
        style="
                --gap: {{ gap }}px;
                --radius: {{ radius }}px;
                --accent: {{ accent }};
                --card-bg: #fff;
                "
>
    {% assign left_block  = section.blocks | where: 'type', 'left_card'   | first %}
    {% assign promo_block = section.blocks | where: 'type', 'promo_banner'| first %}
    {% assign small1_block= section.blocks | where: 'type', 'small_left'  | first %}
    {% assign small2_block= section.blocks | where: 'type', 'small_right' | first %}

    <div class="grid-wrap">
        {%- if left_block -%}
            <div class="left-col card">
            {%- if left_block.settings.link != blank -%}<a href="{{ left_block.settings.link }}">{%- endif -%}

                    {%- if left_block.settings.logo != blank -%}
                        <div class="brand">
                            {{ left_block.settings.logo | image_url: width: 360 | image_tag: alt: left_block.settings.logo_alt, class: 'brand-img' }}
                        </div>
                    {%- endif -%}

                    <div class="prod-stack">
                        {%- if left_block.settings.img1 != blank -%}
                            {{ left_block.settings.img1 | image_url: width: 800 | image_tag: alt: left_block.settings.alt1, class: 'prod-img' }}
                        {%- else -%}
                            <div class="ph ph--prod">Imagen 1</div>
                        {%- endif -%}

                        {%- if left_block.settings.img2 != blank -%}
                            {{ left_block.settings.img2 | image_url: width: 800 | image_tag: alt: left_block.settings.alt2, class: 'prod-img' }}
                        {%- else -%}
                            <div class="ph ph--prod">Imagen 2</div>
                        {%- endif -%}
                    </div>

                    {%- if left_block.settings.link != blank -%}</a>{%- endif -%}
            </div>
        {%- endif -%}

        <div class="right-col">
            <div class="promo-top card">
                {%- if promo_block -%}
                    {%- if promo_block.settings.link != blank -%}<a href="{{ promo_block.settings.link }}">{%- endif -%}
                    {%- if promo_block.settings.image != blank -%}
                        {{ promo_block.settings.image | image_url: width: 1400 | image_tag: alt: promo_block.settings.alt, class: 'banner-img' }}
                    {%- else -%}
                        <div class="ph ph--banner">Banner</div>
                    {%- endif -%}
                    {%- if promo_block.settings.link != blank -%}</a>{%- endif -%}
                {%- else -%}
                    <div class="ph ph--banner">Banner</div>
                {%- endif -%}
            </div>

            <div class="mini-row">
                <div class="mini card">
                    {%- if small1_block -%}
                        {%- if small1_block.settings.link != blank -%}<a href="{{ small1_block.settings.link }}">{%- endif -%}
                        {%- if small1_block.settings.image != blank -%}
                            {{ small1_block.settings.image | image_url: width: 900 | image_tag: alt: small1_block.settings.alt, class: 'mini-img' }}
                        {%- else -%}
                            <div class="ph ph--mini">Mini 1</div>
                        {%- endif -%}
                        {%- if small1_block.settings.link != blank -%}</a>{%- endif -%}
                    {%- else -%}
                        <div class="ph ph--mini">Mini 1</div>
                    {%- endif -%}
                </div>

                <div class="mini card">
                    {%- if small2_block -%}
                        {%- if small2_block.settings.link != blank -%}<a href="{{ small2_block.settings.link }}">{%- endif -%}
                        {%- if small2_block.settings.image != blank -%}
                            {{ small2_block.settings.image | image_url: width: 900 | image_tag: alt: small2_block.settings.alt, class: 'mini-img' }}
                        {%- else -%}
                            <div class="ph ph--mini">Mini 2</div>
                        {%- endif -%}
                        {%- if small2_block.settings.link != blank -%}</a>{%- endif -%}
                    {%- else -%}
                        <div class="ph ph--mini">Mini 2</div>
                    {%- endif -%}
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    #mymy-grid-{{ section.id }} .grid-wrap{
        display:grid;
        grid-template-columns: 1.6fr 1fr;
        gap: var(--gap);
        align-items: start; /* evita que las celdas estiren los cards */
    }
    #mymy-grid-{{ section.id }} .left-col{ align-self: start; }
    #mymy-grid-{{ section.id }} .right-col{
        display:grid; grid-template-rows: auto 1fr; gap: var(--gap);
        align-items: start;
    }
    #mymy-grid-{{ section.id }} .mini-row{
        display:grid; grid-template-columns: 1fr 1fr; gap: var(--gap);
        align-items: start;
    }

    /* Cards y bordes ajustados al contenido */
    #mymy-grid-{{ section.id }} .card {
        background: var(--card-bg);
        border-radius: var(--radius);
        border: 2px solid var(--accent);
        overflow: hidden;
        display: inline-block;  /* se ajusta al contenido */
        width: fit-content;     /* colapsa al contenido */
        margin: 0 auto;         /* centra el card en la celda */
        text-align: center;
    }

    /* Logo con control desde schema */
    #mymy-grid-{{ section.id }} .brand-img {
        max-width: {{ logo_max_width }}px;
        height:auto;
        display:block;
        margin: 0 auto;
    }

    /* Productos con control desde schema */
    #mymy-grid-{{ section.id }} .prod-img {
        max-width: {{ prod_img_max_width }}px;
        width: 100%;
        margin: 8px auto;
        height:auto;
        object-fit: contain;
    }

    /* Banner promo */
    #mymy-grid-{{ section.id }} .banner-img{ width:100%; height:auto; display:block; object-fit: cover; }

    /* Minis */
    #mymy-grid-{{ section.id }} .mini-img{ width:100%; height:auto; display:block; object-fit: cover; }

    /* Placeholders */
    #mymy-grid-{{ section.id }} .ph{
        display:flex; align-items:center; justify-content:center; color:#999; background:#fafafa;
    }
    #mymy-grid-{{ section.id }} .ph--prod{ min-height: 180px; }
    #mymy-grid-{{ section.id }} .ph--banner{ min-height: 220px; }
    #mymy-grid-{{ section.id }} .ph--mini{ min-height: 200px; }

    /* Responsive */
    @media (max-width: 980px){
        #mymy-grid-{{ section.id }} .grid-wrap{ grid-template-columns: 1fr; }
    }
</style>

{% schema %}
{
  "name": "MYMY Grid",
  "settings": [
    { "type": "color", "id": "accent", "label": "Color borde", "default": "#f8ccd2" },
    { "type": "range", "id": "radius", "label": "Radio esquinas (px)", "min": 0, "max": 30, "step": 1, "default": 16 },
    { "type": "range", "id": "gap", "label": "Espacio entre cards (px)", "min": 8, "max": 32, "step": 1, "default": 12 },
    { "type": "range", "id": "logo_max_width", "label": "Ancho máximo logo (px)", "min": 50, "max": 400, "step": 10, "default": 200 },
    { "type": "range", "id": "prod_img_max_width", "label": "Ancho máximo producto (px)", "min": 100, "max": 600, "step": 10, "default": 300 }
  ],
  "blocks": [
    {
      "type": "left_card",
      "name": "Card vertical",
      "limit": 1,
      "settings": [
        { "type": "image_picker", "id": "logo", "label": "Logo (arriba)" },
        { "type": "text", "id": "logo_alt", "label": "Alt logo", "default": "MYMY shoes" },
        { "type": "image_picker", "id": "img1", "label": "Producto 1 (izq)" },
        { "type": "text", "id": "alt1", "label": "Alt producto 1", "default": "Producto 1" },
        { "type": "image_picker", "id": "img2", "label": "Producto 2 (abajo)" },
        { "type": "text", "id": "alt2", "label": "Alt producto 2", "default": "Producto 2" },
        { "type": "url", "id": "link", "label": "Link (opcional)" }
      ]
    },
    {
      "type": "promo_banner",
      "name": "Promo banner",
      "limit": 1,
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Imagen banner" },
        { "type": "text", "id": "alt", "label": "Alt banner", "default": "Promoción" },
        { "type": "url", "id": "link", "label": "Link (opcional)" }
      ]
    },
    {
      "type": "small_left",
      "name": "Mini izq",
      "limit": 1,
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Imagen mini 1" },
        { "type": "text", "id": "alt", "label": "Alt mini 1", "default": "Producto" },
        { "type": "url", "id": "link", "label": "Link (opcional)" }
      ]
    },
    {
      "type": "small_right",
      "name": "Mini der",
      "limit": 1,
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Imagen mini 2" },
        { "type": "text", "id": "alt", "label": "Alt mini 2", "default": "Producto" },
        { "type": "url", "id": "link", "label": "Link (opcional)" }
      ]
    }
  ],
  "max_blocks": 4,
  "presets": [
    {
      "name": "MYMY Grid",
      "blocks": [
        { "type": "left_card" },
        { "type": "promo_banner" },
        { "type": "small_left" },
        { "type": "small_right" }
      ]
    }
  ]
}
{% endschema %}
